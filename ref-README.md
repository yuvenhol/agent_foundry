# LangChain ç‰ˆæœ¬ Agent Foundry

> **é‡è¦è¯´æ˜**ï¼šæœ¬æ–‡æ¡£ä¾§é‡æ¶æ„è®¾è®¡å’Œæ ¸å¿ƒæ¦‚å¿µï¼Œæä¾›å…³é”® API ä½¿ç”¨ç¤ºä¾‹ã€‚å®Œæ•´å®ç°è¯·å‚è€ƒæºä»£ç ï¼Œä¸åŒ…å«æ‰€æœ‰ç»†èŠ‚ä»£ç ã€‚

## ç®€ä»‹

åŸºäº **LangChain 1.1+** çš„ Agent Foundry å®ç°ï¼Œä½¿ç”¨ `create_agent` å’Œ **Middleware** æ¶æ„ã€‚ä¸¤é˜¶æ®µæ¶æ„ï¼šé€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯åˆ›å»º Agent é…ç½®ï¼Œç„¶ååŸºäºé…ç½®æ‰§è¡Œ Agentã€‚


## ç›®å½•ç»“æ„

```bash
src/agent_foundry/langchain/
â”œâ”€â”€ README.md              # å½“å‰æ¨¡å—çš„æ¶æ„è¯´æ˜ä¸å¼€å‘æŒ‡å—ï¼ˆæœ¬æ–‡ä»¶ï¼Œå·²å­˜åœ¨ï¼‰
â”œâ”€â”€ master_agent.py        # MasterAgent å®ç°ï¼Œè´Ÿè´£å¯¹è¯å¼ Agent é…ç½®ç”Ÿæˆï¼ˆè§„åˆ’ä¸­ï¼‰
â”œâ”€â”€ runtime.py             # Runtime å®ç°ï¼Œæ ¹æ® AgentSpec æ„å»ºå¯æ‰§è¡Œ Agentï¼ˆè§„åˆ’ä¸­ï¼‰
â””â”€â”€ tools/                 # å·¥å…·ç›®å½•ï¼ˆè§„åˆ’ä¸­ï¼‰
    â”œâ”€â”€ __init__.py        # å·¥å…·æ³¨å†Œé€»è¾‘ï¼Œè‡ªåŠ¨æ‰«æå’Œæ³¨å†Œå·¥å…·
    â”œâ”€â”€ weather.py         # å¤©æ°”æŸ¥è¯¢ç­‰ç¤ºä¾‹å·¥å…·
    â”œâ”€â”€ file_operations.py # æ–‡ä»¶è¯»å†™ç›¸å…³å·¥å…·
    â””â”€â”€ web_search.py      # ç½‘ç»œæœç´¢ç›¸å…³å·¥å…·

examples/                  # ç¤ºä¾‹ AgentSpec é…ç½®ç­‰
â””â”€â”€ langchain/
    â””â”€â”€ weather_agent.json # å¤©æ°”åŠ©æ‰‹ç¤ºä¾‹é…ç½®

tests/                     # æµ‹è¯•æ¨¡å—
â””â”€â”€ langchain/
    â”œâ”€â”€ test_master_agent.py
    â””â”€â”€ test_runtime.py
```

## æ ¸å¿ƒç‰¹æ€§

- ğŸ¯ **è‡ªç„¶è¯­è¨€åˆ›å»º Agent**: é€šè¿‡å¯¹è¯å®šä¹‰ Agent èƒ½åŠ›
- ğŸ”§ **åŠ¨æ€å·¥å…·ç³»ç»Ÿ**: æ”¯æŒå·¥å…·æ³¨å†Œã€å‘ç°å’ŒåŠ¨æ€åŠ è½½
- ğŸ”„ **äº¤äº’å¼æ¾„æ¸…**: è‡ªåŠ¨è¯†åˆ«ä¿¡æ¯ç¼ºå¤±,å¼•å¯¼ç”¨æˆ·è¡¥å……
- ğŸ—ï¸ **LangChain 1.1+**: åŸºäº `create_agent` å’Œ Middleware æ„å»º
- ğŸ“„ **è‡ªæè¿°é…ç½®**: AgentSpec JSON æ ¼å¼,æ˜“äºå­˜å‚¨å’Œç‰ˆæœ¬ç®¡ç†
- ğŸ§  **æ™ºèƒ½æ€»ç»“**: é›†æˆ SummarizationMiddleware å¤„ç†é•¿å¯¹è¯

## ä¸¤é˜¶æ®µæµç¨‹æ€»è§ˆ

```mermaid
flowchart TD
    U[æ‰“é€ Agentç”¨æˆ·] -->|éœ€æ±‚è¾“å…¥| M
    M -->|å¼•å¯¼ç”¨æˆ·é—®é¢˜| U
    M[MasterAgent] -->|è°ƒç”¨å·¥å…·| Q[AskClarityQuestions]
    Q -->|è¿”å›æ¾„æ¸…é—®é¢˜| M
    M -->|ç”Ÿæˆ| JS[AgentSpec JSON]
    JS -->|è¾“å…¥| R[Runtime]
    U1[ä½¿ç”¨Agentç”¨æˆ·] -->|ç”¨æˆ·è¾“å…¥| R
    R -->|create_agent| A[å¯æ‰§è¡ŒAgent]
    A -->|è°ƒç”¨å·¥å…·| T[Tools]
    T -->|è¿”å›ç»“æœ| A
    A -->|è°ƒç”¨| SA[SubAgents]
    SA -->|è¿”å›ç»“æœ| A
```

### é˜¶æ®µä¸€: æ‰“é€  Agent

MasterAgent é€šè¿‡å¯¹è¯æ”¶é›†ä¿¡æ¯,ç”Ÿæˆ AgentSpec JSON:

1. **ç”¨æˆ·è¾“å…¥**: "åˆ›å»ºä¸€ä¸ªå¤©æ°”æŸ¥è¯¢ Agent,èƒ½æŸ¥è¯¢å›½å†…å¤–åŸå¸‚çš„å®æ—¶å¤©æ°”"
2. **ä¿¡æ¯æ£€æŸ¥**: MasterAgent è°ƒç”¨ `ask_clarity_questions` å·¥å…·åˆ†æå¯¹è¯å†å²
3. **æ¾„æ¸…äº¤äº’**: å·¥å…·è¿”å›éœ€è¦æ¾„æ¸…çš„é—®é¢˜(å¦‚æ¨¡å‹é€‰æ‹©ã€å·¥å…·é…ç½®)
4. **å‰ç«¯å±•ç¤º**: å‰ç«¯å±•ç¤ºé€‰æ‹©é¢˜æˆ–å¼€æ”¾é—®é¢˜,æ”¶é›†ç”¨æˆ·ç­”æ¡ˆ
5. **ç­”æ¡ˆæ‹¼æ¥**: å‰ç«¯å°†"é—®é¢˜+ç­”æ¡ˆ"æ‹¼æ¥æˆå®Œæ•´æ¶ˆæ¯,ç»§ç»­å¯¹è¯
6. **ç”Ÿæˆé…ç½®**: ä¿¡æ¯å®Œæ•´å,MasterAgent è¾“å‡º AgentSpec JSON

**è¾“å‡ºç¤ºä¾‹**:

```json
{
  "name": "weather_assistant",
  "description": "å¤©æ°”æŸ¥è¯¢åŠ©æ‰‹ï¼Œæ”¯æŒæŸ¥è¯¢å›½å†…å¤–åŸå¸‚çš„å®æ—¶å¤©æ°”ä¿¡æ¯",
  "system_prompt": "ä½ æ˜¯ä¸€ä¸ªå¤©æ°”æŸ¥è¯¢åŠ©æ‰‹ï¼Œèƒ½å¤ŸæŸ¥è¯¢å…¨çƒåŸå¸‚çš„å®æ—¶å¤©æ°”ä¿¡æ¯ã€‚ä½¿ç”¨ fetch_weather å·¥å…·è·å–å¤©æ°”ï¼Œç”¨ä¸­æ–‡å›å¤ç”¨æˆ·ï¼Œå¹¶æä¾›æ¸©åº¦ã€å¤©æ°”çŠ¶å†µã€å»ºè®®ç­‰æœ‰ç”¨ä¿¡æ¯ã€‚",
  "model": "flash",
  "temperature": 0.7,
  "tools": ["fetch_weather"]
}
```

### é˜¶æ®µäºŒ: ä½¿ç”¨ Agent

Runtime æ ¹æ® AgentSpec æ„å»ºå¯æ‰§è¡Œ Agent:

1. **åŠ è½½é…ç½®**: è§£æ AgentSpec JSON,éªŒè¯æ ¼å¼
2. **å·¥å…·åŠ è½½**: ä»å·¥å…·æ³¨å†Œè¡¨åŠ è½½å·¥å…·å®ä¾‹
3. **Agent æ„å»º**: ä½¿ç”¨ `AgentFactory` æ„å»º Agent,é›†æˆ SummarizationMiddleware
4. **æ‰§è¡Œ**: æ¥æ”¶ç”¨æˆ·è¾“å…¥,æ‰§è¡Œ Agent,è¿”å›ç»“æœ

---

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. AgentSpec è§„èŒƒ

å®Œæ•´çš„ AgentSpec JSON Schema:

```python
class AgentSpec(BaseModel):
    """Agent é…ç½®è§„èŒƒ"""
    name: str = Field(description="Agent åç§°(è‹±æ–‡æ ‡è¯†ç¬¦)")
    description: str = Field(description="èŒè´£æè¿°")
    system_prompt: str = Field(description="ç³»ç»Ÿæç¤ºè¯")
    model: Literal["pro", "flash"] = Field(description="æ¨¡å‹ç±»å‹: pro (é«˜è´¨é‡,é€‚åˆå¤æ‚ä»»åŠ¡), flash (å¿«é€Ÿå“åº”,é€‚åˆç®€å•ä»»åŠ¡)")
    temperature: float = Field(default=0.5, description="é‡‡æ ·æ¸©åº¦: 0.3-0.5 (ç¡®å®šæ€§ä»»åŠ¡), 0.7-1.0 (åˆ›é€ æ€§ä»»åŠ¡)")
    tools: List[str] = Field(description="å·¥å…·åç§°åˆ—è¡¨(å¿…é¡»ä¸æ³¨å†Œè¡¨ä¸­çš„å·¥å…·ååŒ¹é…)")
    subagents: Optional[List[SubAgentSpec]] = Field(default=None, description="å­Agent")
    version: str = Field(default="1.0", description="é…ç½®ç‰ˆæœ¬")
    max_iterations: Optional[int] = Field(default=None, description="æœ€å¤§è¿­ä»£æ¬¡æ•°")
    # æ–°å¢: SummarizationMiddleware é…ç½®
    summarization: Optional[SummarizationConfig] = Field(default=None, description="å¯¹è¯æ€»ç»“é…ç½®")

class SubAgentSpec(BaseModel):
    """å­Agentè§„èŒƒ(ç®€åŒ–ç‰ˆ)"""
    name: str = Field(description="å­Agentåç§°")
    description: str = Field(description="å­AgentèŒè´£æè¿°")
    system_prompt: str = Field(description="å­Agentç³»ç»Ÿæç¤ºè¯")
    tools: List[str] = Field(description="å·¥å…·åç§°åˆ—è¡¨")
    model: str = Field(description="æ¨¡å‹ç±»å‹")

class SummarizationConfig(BaseModel):
    """SummarizationMiddleware é…ç½®"""
    enabled: bool = Field(default=True, description="æ˜¯å¦å¯ç”¨æ€»ç»“")
    model: str = Field(default="flash", description="æ€»ç»“ç”¨æ¨¡å‹")
    trigger_tokens: Optional[int] = Field(default=4000, description="è§¦å‘æ€»ç»“çš„tokené˜ˆå€¼")
    trigger_messages: Optional[int] = Field(default=10, description="è§¦å‘æ€»ç»“çš„æ¶ˆæ¯æ•°é˜ˆå€¼")
    keep_messages: Optional[int] = Field(default=20, description="ä¿ç•™çš„æœ€è¿‘æ¶ˆæ¯æ•°")
```

### 2. MasterAgent å®ç°

**æ ¸å¿ƒæ€è·¯**: ä½¿ç”¨ `create_agent` åˆ›å»º,é›†æˆ `SummarizationMiddleware` å¤„ç†é•¿å¯¹è¯

**å…³é”® API**: `create_agent()` + `SummarizationMiddleware`

**ç³»ç»Ÿæç¤ºè¯è®¾è®¡**:

ç³»ç»Ÿæç¤ºè¯éœ€è¦æŒ‡å¯¼ MasterAgent å¼•å¯¼ç”¨æˆ·æä¾›å®Œæ•´ä¿¡æ¯ï¼Œå¹¶æ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦å­ Agentã€‚åŒ…å«ä»¥ä¸‹æ ¸å¿ƒå†…å®¹ï¼š

**1. åŸºç¡€ä¿¡æ¯æ”¶é›†**:

- Agent åç§°ã€æè¿°ã€ç³»ç»Ÿæç¤ºè¯
- æ¨¡å‹é€‰æ‹©ï¼ˆpro/flashï¼‰ã€æ¸©åº¦å‚æ•°
- å·¥å…·åˆ—è¡¨ï¼ˆä»æ³¨å†Œè¡¨ä¸­é€‰æ‹©ï¼‰

**2. å­ Agent ä½¿ç”¨æŒ‡å—**:

MasterAgent éœ€è¦æ ¹æ®ä»»åŠ¡å¤æ‚åº¦åˆ¤æ–­æ˜¯å¦éœ€è¦å­ Agentï¼š

**ä¸ºä»€ä¹ˆä½¿ç”¨å­ Agentï¼Ÿ**
å­ Agent è§£å†³ä¸Šä¸‹æ–‡è†¨èƒ€é—®é¢˜ã€‚å½“ Agent ä½¿ç”¨è¾“å‡ºè¾ƒå¤§çš„å·¥å…·ï¼ˆç½‘ç»œæœç´¢ã€æ–‡ä»¶è¯»å–ã€æ•°æ®åº“æŸ¥è¯¢ï¼‰æ—¶ï¼Œä¸Šä¸‹æ–‡çª—å£ä¼šè¿…é€Ÿè¢«ä¸­é—´ç»“æœå¡«æ»¡ã€‚å­ Agent éš”ç¦»è¿™äº›è¯¦ç»†å·¥ä½œâ€”â€”ä¸» Agent åªæ¥æ”¶æœ€ç»ˆç»“æœï¼Œè€Œä¸æ˜¯äº§ç”Ÿå®ƒçš„æ•°åä¸ªå·¥å…·è°ƒç”¨ã€‚

**ä½•æ—¶ä½¿ç”¨å­ Agentï¼š**

- âœ… å¤šæ­¥éª¤ä»»åŠ¡ï¼Œä¼š clutter ä¸» Agent çš„ä¸Šä¸‹æ–‡
- âœ… éœ€è¦è‡ªå®šä¹‰æŒ‡ä»¤æˆ–å·¥å…·çš„ä¸“ä¸šé¢†åŸŸ
- âœ… éœ€è¦ä¸åŒæ¨¡å‹èƒ½åŠ›çš„ä»»åŠ¡
- âœ… å¸Œæœ›ä¸» Agent ä¸“æ³¨äºé«˜å±‚åè°ƒ

**ä½•æ—¶ä¸ä½¿ç”¨å­ Agentï¼š**

- âŒ ç®€å•çš„å•æ­¥éª¤ä»»åŠ¡
- âŒ éœ€è¦ä¿æŒä¸­é—´ä¸Šä¸‹æ–‡æ—¶
- âŒ å¼€é”€å¤§äºæ”¶ç›Šæ—¶

**å­ Agent é…ç½®è¦ç‚¹ï¼š**

- å­ Agent ä¹Ÿæœ‰ç‹¬ç«‹çš„ system_promptã€modelã€tools
- å­ Agent å¯é…ç½®ç‹¬ç«‹çš„ SummarizationMiddlewareï¼ˆé˜ˆå€¼é€šå¸¸æ¯”ä¸» Agent ä½ï¼‰
- ä»»åŠ¡åˆ†è§£ï¼šå°†å¤æ‚ä»»åŠ¡æ‹†è§£ä¸ºå¤šä¸ªå­ Agentï¼ˆå¦‚æ•°æ®åˆ†æ â†’ æ•°æ®æ¸…æ´— â†’ å¯è§†åŒ–ï¼‰

**3. è¾“å‡ºæ ¼å¼**ï¼šåªè¾“å‡ºç¬¦åˆ AgentSpec è§„èŒƒçš„ JSON

**SummarizationMiddleware é…ç½®**:

```python
# ä½¿ç”¨ AgentFactory åˆ›å»º MasterAgent
agent = AgentFactory.create_agent(
    model="pro",
    tools=[ask_clarity_questions],
    middleware=[
        SummarizationMiddleware(
            model="flash",  # æ€»ç»“ç”¨è½»é‡æ¨¡å‹
            trigger={"tokens": 4000, "messages": 10},  # è§¦å‘æ¡ä»¶
            keep={"messages": 20},  # ä¿ç•™æœ€è¿‘æ¶ˆæ¯
        )
    ],
    system_prompt=system_prompt,
)
```

**æ ¸å¿ƒä¼˜åŠ¿**:

- `AgentFactory` å°è£…åº•å±‚ç»†èŠ‚ï¼šä»£ç æ›´ç®€æ´ï¼Œæ˜“äºç»´æŠ¤
- `SummarizationMiddleware`ï¼šè‡ªåŠ¨å¤„ç†é•¿å¯¹è¯ï¼Œé¿å… token è¶…é™
- ä¿ç•™æœ€è¿‘å¯¹è¯ï¼šä¿ç•™å…³é”®ä¸Šä¸‹æ–‡ï¼Œé¿å…ä¿¡æ¯ä¸¢å¤±
- é™ä½æˆæœ¬ï¼šæ€»ç»“ç”¨è½»é‡æ¨¡å‹ï¼Œå¹³è¡¡æˆæœ¬å’Œè´¨é‡

### 3. Runtime å®ç° (AgentFactory)

**èŒè´£**: æ ¹æ® AgentSpec æ„å»ºå¯æ‰§è¡Œ Agentï¼Œä½¿ç”¨ `AgentFactory` ç»Ÿä¸€ç®¡ç†æ„å»ºè¿‡ç¨‹ã€‚

**æ„å»ºæµç¨‹**:

1. **åŠ è½½å·¥å…·**: ä»æ³¨å†Œè¡¨åŠ è½½ AgentSpec ä¸­å®šä¹‰çš„å·¥å…·
2. **å¤„ç†å­ Agent**: å°†å­ Agent é…ç½®åŒ…è£…æˆ BaseTool
3. **é…ç½® Middleware**: æŒ‰éœ€æ·»åŠ  SummarizationMiddleware
4. **åˆ›å»º Agent**: è°ƒç”¨ `AgentFactory.create_agent()` æ„å»ºå¯æ‰§è¡Œå®ä¾‹

**å…³é”® API ç¤ºä¾‹**:

```python
from .factory import AgentFactory
from .middleware import SummarizationMiddleware

# åŠ¨æ€æ„å»º Agent
agent = AgentFactory.create_agent(
    model=agent_spec["model"],  # è‡ªåŠ¨æ˜ å°„ä¸º LLM å®ä¾‹
    tools=loaded_tools,  # ä»æ³¨å†Œè¡¨åŠ è½½çš„å·¥å…·
    middleware=[
        SummarizationMiddleware(
            model=summ_config.get("model", "flash"),
            trigger={
                "tokens": summ_config.get("trigger_tokens", 4000),
                "messages": summ_config.get("trigger_messages", 10),
            },
            keep={"messages": summ_config.get("keep_messages", 20)},
        )
    ] if enable_summarization else [],
    system_prompt=agent_spec["system_prompt"],
)
```

**AgentFactory èŒè´£**:

- **æ¨¡å‹å·¥å‚**: è´Ÿè´£å°†å­—ç¬¦ä¸² ("pro", "flash") è½¬æ¢ä¸ºå®é™…çš„ LangChain ChatModel
- **Memory ç»„è£…**: è´Ÿè´£å°† Middleware è½¬æ¢ä¸º LangChain çš„ Memory æˆ– Callback æœºåˆ¶
- **Agent ç»„è£…**: æœ€ç»ˆè°ƒç”¨ LangChain çš„ `create_tool_calling_agent` æˆ–å…¶ä»–æ„é€ å‡½æ•°

**æ ¸å¿ƒä¼˜åŠ¿**:

- å£°æ˜å¼é…ç½®ï¼šé€šè¿‡ `AgentFactory` ä¸€è¡Œä»£ç æ„å»º Agent
- å¯é€‰æ€»ç»“ï¼šæ ¹æ®é…ç½®åŠ¨æ€å¯ç”¨ SummarizationMiddleware
- å·¥å…·éªŒè¯ï¼šåŠ è½½æ—¶æ£€æŸ¥å·¥å…·å­˜åœ¨æ€§ï¼Œæä¾›æ¸…æ™°é”™è¯¯ä¿¡æ¯
- åµŒå¥—æ”¯æŒï¼šå­ Agent è‡ªåŠ¨åŒ…è£…ï¼Œæ”¯æŒå¤šçº§è°ƒç”¨

**LCEL vs create_agent å¯¹æ¯”**:

| ç‰¹æ€§           | LCEL æ–¹å¼              | Factory + Middleware               |
| -------------- | ---------------------- | ---------------------------------- |
| ä»£ç å¤æ‚åº¦     | è¾ƒé«˜ï¼ˆæ‰‹åŠ¨ç»„è£… chainï¼‰ | è¾ƒä½ï¼ˆå£°æ˜å¼é…ç½®ï¼‰                 |
| å¯¹è¯æ€»ç»“       | æ‰‹åŠ¨å®ç°               | å†…ç½® SummarizationMiddleware       |
| å¯æ‰©å±•æ€§       | éœ€è¦è‡ªå®šä¹‰é€»è¾‘         | é€šè¿‡ middleware ç»„åˆï¼Œå³æ’å³ç”¨     |
| ç»´æŠ¤æˆæœ¬       | è¾ƒé«˜                   | è¾ƒä½ï¼Œç¬¦åˆ LangChain 1.1+ æœ€ä½³å®è·µ |
| LangChain ç‰ˆæœ¬ | 1.0                    | 1.1+ï¼ˆæ¨èï¼‰                       |

### 4. å·¥å…·ç³»ç»Ÿ

**å·¥å…·å®šä¹‰**: åœ¨ `tools/` ç›®å½•ä¸­åˆ›å»º Python æ–‡ä»¶,ä½¿ç”¨å‡½æ•°å¼å®šä¹‰å’Œè‡ªåŠ¨æ³¨å†Œæœºåˆ¶

- **åˆ›å»ºå·¥å…·**: åœ¨ `tools/` ç›®å½•ä¸‹æ–°å»º Python æ–‡ä»¶ï¼ˆå¦‚ `weather.py`ã€`file_operations.py`ï¼‰
- **ä½¿ç”¨è£…é¥°å™¨**: ç”¨ `@tool` è£…é¥°å™¨æ ‡è®°å·¥å…·å‡½æ•°
- **ç±»å‹æ³¨è§£**: æ·»åŠ å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹æ³¨è§£
- **å®Œæ•´ docstring**: æè¿°åŠŸèƒ½ã€å‚æ•°ã€è¿”å›å€¼ã€å¯èƒ½çš„é”™è¯¯
- **è‡ªåŠ¨æ³¨å†Œ**: æ¨¡å—åŠ è½½æ—¶è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œæ‰€æœ‰ `@tool` å‡½æ•°

**å·¥å…·æ³¨å†Œæœºåˆ¶**:

- æä¾› `TOOLS_REGISTRY` å…¨å±€æ³¨å†Œè¡¨
- `register_tool()`: æ³¨å†Œå·¥å…·åˆ°å…¨å±€æ³¨å†Œè¡¨
- `get_tool_by_name(name)`: æ ¹æ®åç§°è·å–å·¥å…·å®ä¾‹
- `get_all_tools()`: è·å–æ‰€æœ‰å¯ç”¨å·¥å…·
- `get_tool_catalog()`: è·å–å·¥å…·ç›®å½•ï¼ˆJSON æ ¼å¼ï¼Œç”¨äº MasterAgent å±•ç¤ºï¼‰

**ä½¿ç”¨æ–¹å¼**:

åœ¨ MasterAgent å’Œ Runtime ä¸­å¯¼å…¥ä½¿ç”¨:

```python
from tools import get_tool_catalog, get_tool_by_name

tools = get_tool_catalog()
# è¿”å›: [{"name": "file_read", "description": "...", "parameters": {...}}, ...]

tool = get_tool_by_name("file_read")
```

**å·¥å…·å¼€å‘è§„èŒƒ**:

1. **å‡½æ•°å¼å®šä¹‰**: ä½¿ç”¨ `@tool` è£…é¥°å™¨
2. **ç±»å‹æ³¨è§£**: å¿…é¡»æ·»åŠ å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹æ³¨è§£
3. **å®Œæ•´ docstring**: æè¿°åŠŸèƒ½ã€å‚æ•°ã€è¿”å›å€¼ã€é”™è¯¯
4. **å‚æ•°æ ¡éªŒ**: åœ¨å‡½æ•°å†…è¿›è¡Œè¾“å…¥éªŒè¯
5. **é”™è¯¯å¤„ç†**: æŠ›å‡ºæ¸…æ™°çš„å¼‚å¸¸ä¿¡æ¯

### 5. å­ Agent å·¥å…·

**è®¾è®¡æ€è·¯**: å°†å­ Agent é…ç½®åŒ…è£…æˆ LangChain BaseToolï¼Œæ”¯æŒåµŒå¥—è°ƒç”¨å’Œç‹¬ç«‹æ€»ç»“

**æ ¸å¿ƒæœºåˆ¶**:

1. **åŒ…è£…å±‚**: å°†å­ Agent å°è£…ä¸º BaseToolï¼Œç¬¦åˆå·¥å…·è°ƒç”¨è§„èŒƒ
2. **é€’å½’æ„å»º**: å­ Agent ä¹Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„å·¥å…·å’Œå­ Agent
3. **ç‹¬ç«‹æ€»ç»“**: æ¯ä¸ªå­ Agent å¯é…ç½®ç‹¬ç«‹çš„ SummarizationMiddleware

**å…³é”®ç‰¹æ€§**:

- ç»Ÿä¸€æ¥å£ï¼šä¸» Agent é€šè¿‡å·¥å…·è°ƒç”¨æ–¹å¼ä½¿ç”¨å­ Agent
- ä¸Šä¸‹æ–‡éš”ç¦»ï¼šå­ Agent çš„å¯¹è¯æ€»ç»“ä¸å½±å“ä¸» Agent
- é”™è¯¯ä¼ æ’­ï¼šå­ Agent æ‰§è¡Œé”™è¯¯å‘ä¸Šä¼ é€’ç»™ä¸» Agent
- çµæ´»é…ç½®ï¼šå­ Agent å¯ä½¿ç”¨ä¸åŒæ¨¡å‹ã€ä¸åŒæ€»ç»“ç­–ç•¥

**ä½¿ç”¨åœºæ™¯ä¸å†³ç­–æŒ‡å—**:

**ä¸ºä»€ä¹ˆä½¿ç”¨å­ Agentï¼Ÿ**
å­ Agent è§£å†³ä¸Šä¸‹æ–‡è†¨èƒ€é—®é¢˜ã€‚å½“ Agent ä½¿ç”¨è¾“å‡ºè¾ƒå¤§çš„å·¥å…·ï¼ˆç½‘ç»œæœç´¢ã€æ–‡ä»¶è¯»å–ã€æ•°æ®åº“æŸ¥è¯¢ï¼‰æ—¶ï¼Œä¸Šä¸‹æ–‡çª—å£ä¼šè¿…é€Ÿè¢«ä¸­é—´ç»“æœå¡«æ»¡ã€‚å­ Agent éš”ç¦»è¿™äº›è¯¦ç»†å·¥ä½œâ€”â€”ä¸» Agent åªæ¥æ”¶æœ€ç»ˆç»“æœï¼Œè€Œä¸æ˜¯äº§ç”Ÿå®ƒçš„æ•°åä¸ªå·¥å…·è°ƒç”¨ã€‚

**ä½•æ—¶ä½¿ç”¨å­ Agentï¼š**

- âœ… å¤šæ­¥éª¤ä»»åŠ¡ï¼Œä¼š clutter ä¸» Agent çš„ä¸Šä¸‹æ–‡ï¼ˆå¦‚ï¼šæ•°æ®åˆ†æ â†’ æ¸…æ´— â†’ å¯è§†åŒ–ï¼‰
- âœ… éœ€è¦è‡ªå®šä¹‰æŒ‡ä»¤æˆ–å·¥å…·çš„ä¸“ä¸šé¢†åŸŸï¼ˆå¦‚ï¼šæ³•å¾‹ä¸“å®¶ã€è´¢åŠ¡åˆ†æï¼‰
- âœ… éœ€è¦ä¸åŒæ¨¡å‹èƒ½åŠ›çš„ä»»åŠ¡ï¼ˆä¸» Agent ç”¨ proï¼Œå­ Agent ç”¨ flashï¼‰
- âœ… å¸Œæœ›ä¸» Agent ä¸“æ³¨äºé«˜å±‚åè°ƒï¼Œè€Œéç»†èŠ‚æ‰§è¡Œ

**ä½•æ—¶ä¸ä½¿ç”¨å­ Agentï¼š**

- âŒ ç®€å•çš„å•æ­¥éª¤ä»»åŠ¡ï¼ˆå¦‚ï¼šå•æ¬¡å¤©æ°”æŸ¥è¯¢ï¼‰
- âŒ éœ€è¦ä¿æŒä¸­é—´ä¸Šä¸‹æ–‡æ—¶ï¼ˆå¦‚ï¼šéœ€è¦æŸ¥çœ‹è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹ï¼‰
- âŒ å¼€é”€å¤§äºæ”¶ç›Šæ—¶ï¼ˆå­ Agent çš„é¢å¤–è°ƒç”¨æˆæœ¬ï¼‰

**å…¸å‹åœºæ™¯ç¤ºä¾‹**:

- **å¤æ‚ä»»åŠ¡åˆ†è§£**ï¼šæ•°æ®åˆ†æï¼ˆä¸»ï¼‰â†’ æ•°æ®æ¸…æ´—ï¼ˆå­ï¼‰â†’ æŠ¥è¡¨ç”Ÿæˆï¼ˆå­ï¼‰
- **é¢†åŸŸä¸“å®¶æ¨¡å¼**ï¼šé€šç”¨åŠ©æ‰‹ï¼ˆä¸»ï¼‰â†’ æ³•å¾‹ä¸“å®¶ï¼ˆå­ï¼‰â†’ è´¢åŠ¡ä¸“å®¶ï¼ˆå­ï¼‰
- **å·¥ä½œæµç¨‹ç¼–æ’**ï¼šé¡¹ç›®ç®¡ç†ï¼ˆä¸»ï¼‰â†’ ä»»åŠ¡åˆ†é…ï¼ˆå­ï¼‰â†’ è¿›åº¦è·Ÿè¸ªï¼ˆå­ï¼‰

### 6. SummarizationMiddleware è¯¦è§£

**ä½œç”¨**: è‡ªåŠ¨æ€»ç»“å¯¹è¯å†å²ï¼Œé¿å… token è¶…é™ï¼Œé™ä½è°ƒç”¨æˆæœ¬

**å®ç°åŸç†**:

1. **ç›‘æ§å¯¹è¯**: æŒç»­ç›‘æ§å¯¹è¯ token æ•°æˆ–æ¶ˆæ¯æ•°
2. **è§¦å‘æ¡ä»¶**: è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä½¿ç”¨è½»é‡æ¨¡å‹æ€»ç»“æ—§æ¶ˆæ¯
3. **çŠ¶æ€æ›´æ–°**: å°†æ€»ç»“ç»“æœæ°¸ä¹…æ›¿æ¢åˆ°å¯¹è¯å†å²ä¸­
4. **ä¿ç•™æœ€è¿‘**: ä¿ç•™æœ€è¿‘ N æ¡æ¶ˆæ¯å®Œæ•´å†…å®¹ï¼Œç¡®ä¿ä¸Šä¸‹æ–‡å®Œæ•´

**æ ¸å¿ƒæƒè¡¡**:

| ç»´åº¦         | æ¨èé…ç½®                 | è¯´æ˜               |
| ------------ | ------------------------ | ------------------ |
| **æ€»ç»“æ—¶æœº** | tokens=4000, messages=10 | å¹³è¡¡è§¦å‘é¢‘ç‡å’Œæˆæœ¬ |
| **ä¿ç•™æ¶ˆæ¯** | keep_messages=20         | ä¿ç•™è¶³å¤Ÿä¸Šä¸‹æ–‡     |
| **æ€»ç»“æ¨¡å‹** | flashï¼ˆè½»é‡ï¼‰            | é™ä½æˆæœ¬ï¼Œé€Ÿåº¦æ›´å¿« |
| **ä¸»æ¨¡å‹**   | proï¼ˆé«˜è´¨é‡ï¼‰            | ç¡®ä¿ä»»åŠ¡æ‰§è¡Œè´¨é‡   |

**ä½¿ç”¨å»ºè®®**:

- **MasterAgent**: å¿…é€‰ï¼Œé•¿å¯¹è¯åœºæ™¯å¿…å¤‡
- **Runtime**: æ¨èï¼Œé•¿ä»»åŠ¡æ‰§è¡Œæ—¶å¯ç”¨
- **SubAgent**: æ ¹æ®å­ä»»åŠ¡å¤æ‚åº¦å†³å®šï¼ˆç®€å•ä»»åŠ¡å¯å…³é—­ï¼‰

**è°ƒä¼˜æŒ‡å—**:

- æ€»ç»“å¤ªé¢‘ç¹ï¼šæé«˜ trigger é˜ˆå€¼
- ä¸Šä¸‹æ–‡ä¸¢å¤±ï¼šå¢å¤§ keep_messages
- æˆæœ¬æ•æ„Ÿï¼šæ€»ç»“æ¨¡å‹å§‹ç»ˆä½¿ç”¨ flash
- æ•ˆæœä¸ä½³ï¼šæ£€æŸ¥æ€»ç»“æ¨¡å‹å’Œä¸»æ¨¡å‹çš„åŒ¹é…åº¦

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

ä¸»è¦æ¨¡å—:

- `master_agent.py`: MasterAgent å®ç°,è´Ÿè´£å¯¹è¯å¼ Agent é…ç½®ç”Ÿæˆ
- `runtime.py`: Runtime å®ç°,è´Ÿè´£æ ¹æ® AgentSpec æ„å»ºå¯æ‰§è¡Œ Agent
- `tools/`: å·¥å…·ç›®å½•
  - `__init__.py`: å·¥å…·æ³¨å†Œé€»è¾‘,è‡ªåŠ¨æ‰«æå’Œæ³¨å†Œå·¥å…·
  - `weather.py`, `file_operations.py`, `web_search.py`: å…·ä½“å·¥å…·å®ç°
- `examples/langchain/`: ç¤ºä¾‹é…ç½® (JSON æ–‡ä»¶ï¼Œä¸ `src` åŒçº§çš„å…¨å±€ `examples/` ç›®å½•ä¸‹)
- `tests/langchain/`: æµ‹è¯•æ¨¡å—ï¼ˆä¸ `src` åŒçº§çš„å…¨å±€ `tests/` ç›®å½•ä¸‹ï¼‰

### æ·»åŠ æ–°å·¥å…·

æ·»åŠ æ–°å·¥å…·çš„æ­¥éª¤:

1. åœ¨ `tools/` ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆå¦‚ `my_feature.py`ï¼‰
2. ä½¿ç”¨ `@tool` è£…é¥°å™¨å®šä¹‰å·¥å…·å‡½æ•°
3. æ·»åŠ ç±»å‹æ³¨è§£å’Œå®Œæ•´ docstring
4. é‡å¯åº”ç”¨è‡ªåŠ¨æ³¨å†Œ

### æµ‹è¯•

**æµ‹è¯•ç­–ç•¥**: ä¼˜å…ˆé›†æˆæµ‹è¯•ï¼ŒéªŒè¯å®Œæ•´å·¥ä½œæµï¼Œé¿å…è¿‡åº¦å•å…ƒæµ‹è¯•

**æ ¸å¿ƒæµ‹è¯•åœºæ™¯**:

1. **MasterAgent æµç¨‹æµ‹è¯•**

   - å¤šè½®å¯¹è¯æ”¶é›†ä¿¡æ¯
   - æ¾„æ¸…é—®é¢˜ç”Ÿæˆå’Œäº¤äº’
   - éªŒè¯è¾“å‡ºç¬¦åˆ AgentSpec è§„èŒƒ

2. **Runtime æ„å»ºæµ‹è¯•**

   - æ ¹æ® AgentSpec æˆåŠŸæ„å»º Agent
   - å·¥å…·åŠ è½½å’ŒéªŒè¯
   - å­ Agent åŒ…è£…å’ŒåµŒå¥—

3. **ç«¯åˆ°ç«¯æµ‹è¯•**

   - å®Œæ•´æµç¨‹ï¼šå¯¹è¯åˆ›å»º Agent -> ä¿å­˜é…ç½® -> åŠ è½½æ‰§è¡Œ -> å®Œæˆä»»åŠ¡
   - æµ‹è¯•ä¸åŒç±»å‹ Agentï¼ˆç®€å•å·¥å…·è°ƒç”¨ã€å¤šå­ Agentï¼‰

4. **SummarizationMiddleware æµ‹è¯•**
   - é•¿å¯¹è¯è§¦å‘æ€»ç»“
   - éªŒè¯æ€»ç»“åä¸Šä¸‹æ–‡ä¿æŒå®Œæ•´æ€§
   - æ€§èƒ½æµ‹è¯•ï¼štoken ä½¿ç”¨é™ä½æ•ˆæœ

**å…³é”®åŸåˆ™**:

- é¿å…è¿‡åº¦ mockï¼šå°½å¯èƒ½ä½¿ç”¨çœŸå®ç»„ä»¶
- å…³æ³¨é›†æˆç‚¹ï¼šAgent æ„å»ºã€å·¥å…·è°ƒç”¨ã€å­ Agent é›†æˆ
- è‡ªåŠ¨åŒ–è¦†ç›–ç‡ï¼šç«¯åˆ°ç«¯åœºæ™¯ä¼˜å…ˆäºå•å…ƒæµ‹è¯•

---

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†å·¥å…·ä¸å­˜åœ¨çš„æƒ…å†µ?

**A**: Runtime åœ¨åŠ è½½å·¥å…·æ—¶ä¼šæ£€æŸ¥æ³¨å†Œè¡¨,å¦‚æœå·¥å…·ä¸å­˜åœ¨ä¼šæŠ›å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯,åˆ—å‡ºæ‰€æœ‰å¯ç”¨å·¥å…·ã€‚

### Q: SubAgent ä¼šå¾ªç¯è°ƒç”¨å—?

**A**: å¯èƒ½ä¼š,å»ºè®®è®¾ç½® `max_iterations` é™åˆ¶ã€‚æ¯ä¸ª SubAgent æ˜¯ç‹¬ç«‹çš„ tool è°ƒç”¨,å—ä¸» Agent çš„è¿­ä»£é™åˆ¶ã€‚

### Q: æ˜¯å¦æ”¯æŒå·¥å…·çƒ­åŠ è½½?

**A**: å½“å‰ç‰ˆæœ¬éœ€è¦é‡å¯åº”ç”¨æ¥åŠ è½½æ–°å·¥å…·ã€‚åç»­å¯è€ƒè™‘åŠ¨æ€å¯¼å…¥æœºåˆ¶ã€‚

### Q: SummarizationMiddleware ä¼šä¸¢å¤±é‡è¦ä¿¡æ¯å—?

**A**: ä¸ä¼šã€‚å®ƒåªæ€»ç»“æ—§æ¶ˆæ¯å¹¶ä¿ç•™æœ€è¿‘ N æ¡å®Œæ•´æ¶ˆæ¯ã€‚å»ºè®® keep_messages è®¾ç½®è¶³å¤Ÿå¤§ï¼ˆå¦‚ 20 æ¡ï¼‰ï¼Œä»¥ä¿ç•™å…³é”®ä¸Šä¸‹æ–‡ã€‚

### Q: ä½•æ—¶ä½¿ç”¨ SummarizationMiddleware?

**A**: å»ºè®®ï¼š

- **å¿…é€‰**: MasterAgentï¼ˆé•¿å¯¹è¯åœºæ™¯ï¼‰
- **æ¨è**: Runtimeï¼ˆæ‰§è¡Œé•¿ä»»åŠ¡æ—¶ï¼‰
- **å¯é€‰**: SubAgentï¼ˆæ ¹æ®å­ä»»åŠ¡å¤æ‚åº¦ï¼‰

### Q: æ€»ç»“é¢‘ç‡å¤ªé«˜æ€ä¹ˆåŠ?

**A**: è°ƒæ•´ trigger é˜ˆå€¼ï¼š

- æé«˜ tokens é˜ˆå€¼ï¼ˆå¦‚ 4000 -> 6000ï¼‰
- æé«˜ messages é˜ˆå€¼ï¼ˆå¦‚ 10 -> 15ï¼‰
- æˆ–ä½¿ç”¨ fraction åŸºäºæ¯”ä¾‹è§¦å‘

### Q: å¦‚ä½•è°ƒè¯• SummarizationMiddleware?

**A**: å¯ä»¥ï¼š

1. æ·»åŠ æ—¥å¿—è®°å½• middleware è§¦å‘æ—¶æœº
2. æ£€æŸ¥å¯¹è¯å†å²ï¼Œè§‚å¯Ÿæ€»ç»“å‰åçš„å˜åŒ–
3. è°ƒä½ trigger é˜ˆå€¼ï¼Œæ›´å®¹æ˜“è§¦å‘æ€»ç»“è¿›è¡Œæµ‹è¯•

## ç›¸å…³èµ„æ–™

- **LangChain å®˜æ–¹æ–‡æ¡£**
  - [LangChain Python æ–‡æ¡£ï¼ˆ1.1+ï¼‰](https://python.langchain.com/docs/)
  - [Agents ä¸ `create_agent` æŒ‡å—](https://python.langchain.com/docs/how_to/#agents)
  - [Tools ä¸å·¥å…·è°ƒç”¨](https://python.langchain.com/docs/how_to/#tools)

- **Agent Foundry é¡¹ç›®æ–‡æ¡£**
  - `docs/architecture.mdx`ï¼šæ•´ä½“æ¶æ„ä¸ LangGraph å®ç°æ¦‚è§ˆ
  - `docs/api-reference.mdx`ï¼šAPI ä½¿ç”¨å‚è€ƒ
  - `resource/api_documentation.md`ï¼šåç«¯æ¥å£è¡¥å……è¯´æ˜